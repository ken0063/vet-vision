rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========================================
    // CURRENT RULES (No Authentication)
    // ========================================
    // These rules allow public read/write access
    // since the app currently doesn't use Firebase Auth
    
    match /animals/{animalId} {
      // Allow anyone to read animal analyses
      allow read: if true;
      
      // Allow anyone to create new animal analyses
      // Validate that required fields are present
      allow create: if request.resource.data.keys().hasAll([
        'animal', 
        'breed',
        'bodyType',
        'frameType',
        'estimatedWeight',
        'weightRange',
        'createdAt'
      ]) 
      && request.resource.data.animal is string
      && request.resource.data.breed is string
      && request.resource.data.bodyType is string
      && request.resource.data.frameType is string
      && request.resource.data.estimatedWeight is number
      && request.resource.data.weightRange is string
      && request.resource.data.createdAt == request.time;
      
      // Prevent updates and deletes for now
      allow update, delete: if false;
    }
    
    // ========================================
    // FUTURE RULES (With Authentication)
    // ========================================
    // Uncomment these rules when you add Firebase Authentication
    // and comment out the rules above
    
    /*
    match /users/{userId} {
      // Users can only read their own data
      allow read: if request.auth != null && request.auth.uid == userId;
      
      // Users can create their own user document
      allow create: if request.auth != null && request.auth.uid == userId;
      
      // Users can update their own data
      allow update: if request.auth != null && request.auth.uid == userId;
      
      // Users can delete their own data
      allow delete: if request.auth != null && request.auth.uid == userId;
      
      // User's animal analyses subcollection
      match /animals/{animalId} {
        // Allow users to read their own animal analyses
        allow read: if request.auth != null && request.auth.uid == userId;
        
        // Allow users to create new analyses with validation
        allow create: if request.auth != null 
          && request.auth.uid == userId
          && request.resource.data.keys().hasAll([
            'animal', 
            'weight', 
            'confidence', 
            'createdAt'
          ])
          && request.resource.data.animal is string
          && request.resource.data.weight is string
          && request.resource.data.confidence is string
          && request.resource.data.createdAt == request.time;
        
        // Allow users to update their own analyses
        allow update: if request.auth != null && request.auth.uid == userId;
        
        // Allow users to delete their own analyses
        allow delete: if request.auth != null && request.auth.uid == userId;
      }
    }
    */
    
    // Block all other paths by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
